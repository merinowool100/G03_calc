<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="./css/style.css"> -->

<style>
/* 全体のレイアウト */
h1{
    font-size:42px;
    margin-bottom: 15px;
}

body {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: Arial, sans-serif;
}
#container {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    width: 80%;
    max-width: 400px;
    position: relative;
}

/* 残り問題数のレイアウト */
#statusArea {
    width: 100%;
    margin-top: 20px;
    text-align: center;
}

/* フィードバック表示用のスタイル（絶対配置で上部に固定） */
#feedback {
    font-size: 70px;
    color: green;
    position: absolute;
    top: 305px; /* AnswerAreaの上に表示 */
    left: 80%;
    transform: translateX(-50%);
    z-index: 10;
    display: none;
    transition: opacity 1s ease-out;
}

.hidden {
    opacity: 0;
}

/* 問題と入力エリアを横並びに配置 */
#problemDisplayContainer {
    display: flex;
    align-items: center;
    gap: 10px; /* 問題と入力エリアの間にスペース */
    margin-top:10px;
    margin-bottom: 5px;
}

#problemDisplay {
    font-size: 46px;
}

/* 解答入力エリアとボタンを横並びに */
#answerArea {
    display: flex;
    gap: 10px;
    align-items: center;
    font-size: 20px;
}

#btnArea{
    display:flex;
    gap: 10px;
    /* align-items: center; */
    margin: 10px;
}


/* 解答ボタンのスタイル */
#submitAnswerButton, #clearButton {
    width:155px;
    height: 40px;
    margin:0;
    padding: 10px 10px;
    font-size: 16px;
    cursor: pointer;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 10px;
}

#submitAnswerButton:hover, #clearButton:hover {
    background-color: #45a049;
}

/* 数字ボタンのレイアウト */
#numberButtons {
    display: grid;
    height: 200px;
    grid-template-columns: repeat(3, 100px);
    gap: 10px;
}

#numberButtons button {
    font-size: 20px;
    padding: 10px 0;
    border-radius: 10px;
}

button:hover {
    opacity: 0.8;
}

button:active {
    transform: translate(0, 2px);
    /* border-bottom: none; */
}

/* 0のボタンを特別に扱う */
#numberButton0 {
    grid-column: span 3;
}

#answerInput{
    width: 50px;
    height:40px;
    text-align: center;
}

.end{
    height: 54px;
    font-size: 38px;
    text-align: center;
}





</style>




    <title>Document</title>
</head>

<body>
    <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css">
        <title>Document</title>
    </head>

    <body>
        <h1>Calc. challenge</h1>

        <div id="container">
            <!-- フィードバック表示エリア -->
            <div id="feedback">〇</div>
            <canvas class="canvas"></canvas>
            <!-- 問題の表示エリア -->
            <div id="problemDisplayContainer">
                <div id="problemDisplay"></div>
                <div id="answerArea">
                    <input type="text" id="answerInput" readonly placeholder="">
                </div>
            </div>
            <div id="btnArea">
                <button class="btn" id="submitAnswerButton">Answer</button>
                <button class="btn" id="clearButton">C</button>
            </div>

            <!-- 数字ボタン -->
            <div id="numberButtons">
                <button onclick="appendNumber(1)">1</button>
                <button onclick="appendNumber(2)">2</button>
                <button onclick="appendNumber(3)">3</button>
                <button onclick="appendNumber(4)">4</button>
                <button onclick="appendNumber(5)">5</button>
                <button onclick="appendNumber(6)">6</button>
                <button onclick="appendNumber(7)">7</button>
                <button onclick="appendNumber(8)">8</button>
                <button onclick="appendNumber(9)">9</button>
                <button id="numberButton0" onclick="appendNumber(0)">0</button>
            </div>

            <!-- 残り問題数 -->
            <div id="statusArea">
                <p id="remainingDisplay">残りの問題数: 10</p>
            </div>
        </div>



        <script src="calc.js"></script> <!-- 上記のJavaScriptファイルを読み込み -->
    </body>

    </html>


<script>

// 問題を格納するリスト
const problems = [];

// 二桁の足し算と引き算の問題をランダムに2問作成
for (let i = 0; i < 2; i++) {
    let num1, num2, isAddition;
    do {
        num1 = Math.floor(Math.random() * 90) + 10; // 10から99の範囲
        num2 = Math.floor(Math.random() * 90) + 10;
        isAddition = Math.random() > 0.5; // 足し算と引き算を半々で選ぶ
    } while ((isAddition && num1 + num2 > 100) || (!isAddition && num1 < num2));

    if (isAddition) {
        problems.push({ question: `${num1} + ${num2}`, answer: num1 + num2, mother: num1 });
    } else {
        problems.push({ question: `${num1} - ${num2}`, answer: num1 - num2, mother: num1 });
    }
}

let currentProblemIndex = 0; // 現在の問題のインデックス

// 残りの問題数を更新する関数
function updateRemainingDisplay() {
    const remainingProblems = problems.length - currentProblemIndex;
    document.getElementById("remainingDisplay").innerText = `残りの問題数: ${remainingProblems}`;
}

// 現在の問題を表示する関数
function showProblem() {
    const currentProblem = problems[currentProblemIndex];
    document.getElementById("problemDisplay").innerText = `Q: ${currentProblem.question} =`;
    updateRemainingDisplay(); // 残りの問題数を更新

    // Canvasの設定--------------------------------------------
    const canvas = document.querySelector(".canvas");
    canvas.width = 320;
    canvas.height = 320;
    const context = canvas.getContext("2d");

    // マス目描画用に数字を設定---------------------------------------
    const rows = Math.floor(currentProblem.mother / 10);
    const residual = currentProblem.mother % 10;

    // 四角を描画する---------------------------------------------
    context.fillStyle = "rgba(255,150,0,0.5)";
    context.beginPath();
    context.moveTo(0, 0);
    context.lineTo(0, 320);
    context.lineTo(rows * 32, 320);
    context.lineTo(rows * 32, 0);
    context.closePath();
    context.fill();

    // あまりの四角を描画する
    context.fillStyle = "rgba(255,150,0,0.5)";
    context.beginPath();
    context.moveTo(rows * 32, 0);
    context.lineTo(rows * 32, 32 * residual);
    context.lineTo((rows + 1) * 32, 32 * residual);
    context.lineTo((rows + 1) * 32, 0);
    context.closePath();
    context.fill();

    // マス目を描画---------------------------------------------
    function cells() {
        const gridSize = 32;
        const gridCount = 10;
        for (let i = 0; i <= gridCount; i++) {
            context.strokeStyle = "gray";
            context.beginPath();
            context.moveTo(0, i * gridSize); // 横線
            context.lineTo(320, i * gridSize);
            context.moveTo(i * gridSize, 0); // 縦線
            context.lineTo(i * gridSize, 320);
            context.closePath();
            context.stroke();
        }
    };
    cells();

    context.strokeStyle = "black";
    context.beginPath();
    context.lineWidth = 3;
    context.moveTo(0, 160);
    context.lineTo(320, 160);
    context.moveTo(160, 0);
    context.lineTo(160, 320);
    context.closePath();
    context.stroke();
}

// 数字ボタンで入力を追加する関数
function appendNumber(number) {
    const answerInput = document.getElementById("answerInput");
    answerInput.value += number;
}

// 回答入力をクリアする関数
document.getElementById("clearButton").addEventListener("click", () => {
    document.getElementById("answerInput").value = "";
});

// 正解・不正解のフィードバックを表示する関数
function showFeedback(isCorrect) {
    const feedback = document.getElementById("feedback");
    const currentProblem = problems[currentProblemIndex];

    if (isCorrect) {
        feedback.innerText = "Correct"; // 正解のフィードバック
        feedback.style.color = "green";
    } else {
        feedback.innerText = "Wrong"; // 不正解のフィードバック
        feedback.style.color = "red";
        // 正しい答えもフィードバックに表示
        feedback.innerText += `${currentProblem.answer}`;
    }

    feedback.style.display = "block";
    feedback.classList.remove("hidden");

    // フェードアウト開始
    setTimeout(() => {
        feedback.classList.add("hidden");
        setTimeout(() => {
            feedback.style.display = "none"; // 完全に非表示
            if (currentProblemIndex < problems.length) {
                showProblem(); // 次の問題を表示
            } else {
                document.getElementById("remainingDisplay").innerText = "残りの問題数: 0";
                document.getElementById("problemDisplay").remove();
                document.getElementById("answerArea").remove();
                const completeMessage = document.createElement("div");
                completeMessage.setAttribute("class", "end")
                completeMessage.innerText = "Mission complete!!";
                document.getElementById("problemDisplayContainer").appendChild(completeMessage);
                document.getElementById("submitAnswerButton").disabled = true;
            }
        }, 300); // フェードアウト後に完全非表示
    }, 300); // 0.3秒間「〇」または「×」を表示してからフェードアウト開始
}

// 回答をチェックする関数
function checkAnswer() {
    const currentProblem = problems[currentProblemIndex];
    const userAnswer = parseInt(document.getElementById("answerInput").value);

    if (userAnswer === currentProblem.answer) {
        showFeedback(true); // 正解のフィードバック表示
        currentProblemIndex++; // 正解の場合、次の問題に進む
    } else {
        showFeedback(false); // 不正解のフィードバック表示
        const incorrectProblem = problems.splice(currentProblemIndex, 1)[0];
        problems.push(incorrectProblem); // 間違えた問題をリストの最後に追加
    }

    // 回答欄をクリア
    document.getElementById("answerInput").value = "";
}

// イベントリスナーの設定
document.getElementById("submitAnswerButton").addEventListener("click", checkAnswer);

// テンキーで入力を処理する
document.addEventListener("keydown", (event) => {
    if (event.key >= "0" && event.key <= "9") { // 数字キーの場合
        appendNumber(event.key); // その数字を入力欄に追加
    } else if (event.key === "Backspace") { // バックスペースの場合
        const answerInput = document.getElementById("answerInput");
        answerInput.value = answerInput.value.slice(0, -1); // 最後の文字を削除
    } else if (event.key === "Enter") { // エンターキーの場合
        checkAnswer(); // 回答をチェック
    } else if (event.key === "Delete") { // デリートキーの場合
        document.getElementById("answerInput").value = ""; // 回答を消去
    }
});

// 最初の問題を表示
showProblem();


</script>



    <!-- <script src="./js/calc.js"></script> -->
</body>

</html>